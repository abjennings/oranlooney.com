<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cracking Playfair Ciphers - OranLooney.com</title>
  <meta property="og:title" content="Cracking Playfair Ciphers - OranLooney.com" />
  <meta name="twitter:title" content="Cracking Playfair Ciphers - OranLooney.com" />
  <meta name="description" content="Once upon a midnight dreary Once upon a midnight dreary Once upon a midnight dreary Once upon a midnight dreary Once upon a midnight dreary Once upon a midnight dreary
Recently the Zodiac 340 was finally cracked after more than 50 years. While the effort to crack it was extremely impressive and you should watch David Oranchak&rsquo;s series on how it was done, the cipher itself was ultimately disappointing. A homophonic substituion cipher with one minor twist that was difficult to crack primarily because several errors were made when encoding it.">
  <meta property="og:description" content="Once upon a midnight dreary Once upon a midnight dreary Once upon a midnight dreary Once upon a midnight dreary Once upon a midnight dreary Once upon a midnight dreary
Recently the Zodiac 340 was finally cracked after more than 50 years. While the effort to crack it was extremely impressive and you should watch David Oranchak&rsquo;s series on how it was done, the cipher itself was ultimately disappointing. A homophonic substituion cipher with one minor twist that was difficult to crack primarily because several errors were made when encoding it.">
  <meta name="twitter:description" content="Once upon a midnight dreary Once upon a midnight dreary Once upon a midnight dreary Once upon a midnight dreary Once upon a midnight dreary Once upon a midnight dreary
Recently the Zodiac 340 was â€¦">
  <meta name="author" content="Oran Looney"/>

  <meta name="generator" content="Hugo 0.42.1" />
  <link rel="stylesheet" href="/css/style.css" media="all" />
  <link rel="stylesheet" href="/css/syntax.css" media="all" />
  <link rel="stylesheet" href="/css/custom.css" media="all" />

  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous" async></script>

  <script defer src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" integrity="sha384-rOA1PnstxnOBLzCLMcre8ybwbTmemjzdNlILg8O7z1lUkLXozs4DHonlDtnE7fpc" crossorigin="anonymous" async></script>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2535855-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'UA-2535855-1');
  </script>

 
</head>

<body>
<header class="site-header">
  <nav class="site-navi">
    <a href="/" class="site-title">OWL</a>
    <ul class="site-navi-items">
      <li class="site-navi-item">
        <a href="/search/" title="Site Search"><i class="fa fa-search"></i></a>
      </li>
      <li class="site-navi-item">
        <a href="/tags/" title="Article Tags"><i class="fa fa-tag"></i></a>
      </li>
      <li class="site-navi-item">
        <a href="/archives/" title="Article Archives"><i class="fa fa-archive"></i></a>
      </li>
      <li class="site-navi-item">
        <a href="/quotes/" title="Favorite Quotes"><i class="fas fa-quote-right"></i></a>
      </li>
      <li class="site-navi-item">
        <a href="/about/" title="About Me"><i class="fa fa-info-circle"></i></a>
      </li>
    </ul>
    
  <ul class="author-social">
    <li><a href="//honeycode.tumblr.com/" target="_blank" title="Honeycode Microblog">
      <svg class="svg-inline--fa fa-w-12" aria-hidden="true" data-prefix="fab" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="20 50 350 450" data-fa-i2svg="">
<path fill="currentColor" d="M193 97l86.6 50v100l-86.6 50l-86.6 -50v-100zM285 255l86.6 50v100l-86.6 50l-86.6 -50v-100zM100 255l86.6 50v100l-86.6 50l-86.6 -50v-100z"></path>
</svg>
    </a></li>
    <li><a href="//linkedin.com/in/oran-looney" target="_blank" title="LinkedIn"><i class="fab fa-linkedin"></i></a></li>
    <li><a href="https://github.com/olooney" target="_blank"  title="github"><i class="fab fa-github"></i></a></li>
    <li><a href="https://stackoverflow.com/users/273231/olooney" target="_blank" title="StackOverflow"><i class="fab fa-stack-overflow"></i></a></li>
    <li><a href="https://stats.stackexchange.com/users/48250/olooney" target="_blank" title="CrossValidated"><i class="fa fa-flask"></i></a></li>

    <li>
      <a href="https://www.librarything.com/catalog.php?view=olooney&amp;offset=0&amp;shelf_rows=10&amp;previousOffset=0&amp;shelf=shelf" target="_blank" title="LibraryThing">
	    <i class="fas fa-book-reader"></i>
	  </a>
	</li>
    
  </ul>

  </nav>
</header>


  <div class="main" role="main">
    <article class="article">
      <img src="/post/playfair_files/lead.jpg" class="article-image" />
      
      <h1 class="article-title">Cracking Playfair Ciphers</h1>
      
      <hr class="article-title-bottom">
      <ul class="article-meta">
        <li class="article-meta-date"><time>June 28, 2023</time></li>
        <li class="article-meta-tags">
          <a href="/tags/math/">
            <i class="fas fa-tag"></i>
            Math
          </a>&nbsp;
        </li>
        <li class="article-meta-tags">
          <a href="/tags/python/">
            <i class="fas fa-tag"></i>
            Python
          </a>&nbsp;
        </li>
        <li class="article-meta-tags">
          <a href="/tags/visualization/">
            <i class="fas fa-tag"></i>
            Visualization
          </a>&nbsp;
        </li>
      </ul>
      
<aside class="toc">
  <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#torus">Torus</a></li>
<li><a href="#known-plaintext-attack">Known Plaintext Attack</a></li>
<li><a href="#simulated-annealing">Simulated Annealing</a></li>
<li><a href="#parallel">Parallel</a></li>
<li><a href="#cython">Cython</a></li>
</ul></li>
</ul>
</nav>
</aside>
      

<p>Once upon a midnight dreary
Once upon a midnight dreary
Once upon a midnight dreary
Once upon a midnight dreary
Once upon a midnight dreary
Once upon a midnight dreary</p>

<p>Recently the Zodiac 340 was finally cracked after more than 50 years.
While the effort to crack it was extremely impressive and you should watch
David Oranchak&rsquo;s series on how it was done, the cipher itself was ultimately
disappointing. A homophonic substituion cipher with one minor twist that was
difficult to crack primarily because several errors were made when encoding it.</p>

<div style="width: 560px; margin: auto">
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/-1oQLPRE21o" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
</div>

<p>Testing</p>

<blockquote>
<p>&ldquo;Playfair is no longer used by military forces because of the advent of
digital encryption devices. This cipher is now regarded as insecure for any
purpose, because modern computers could easily break it within microseconds.&rdquo;</p>
</blockquote>

<p><a href="https://en.wikipedia.org/wiki/Playfair_cipher">https://en.wikipedia.org/wiki/Playfair_cipher</a></p>

<p>Really, microseconds? That&rsquo;s a little surprising. If we interpret &ldquo;microseconds&rdquo;
to mean less than one millisecond, that</p>

<h2 id="torus">Torus</h2>

<p>As I pondered, weak and weary
As I pondered, weak and weary
As I pondered, weak and weary
As I pondered, weak and weary
As I pondered, weak and weary
As I pondered, weak and weary</p>

<div id="playfairCanvas"><img src="/post/playfair_files/texture.png"></div>

<p>Suddenly there came a tapping.</p>

<div id="playfairTorus"><img src="/post/playfair_files/torus.png"></div>

<p><link rel="stylesheet" href="/post/playfair_files/playfair.css"></p>

<script type="module">
    import { renderPlayfairCanvas, renderPlayfairTorus } from '/post/playfair_files/playfair_torus.js';
    renderPlayfairTorus('MYNAEISORWLBCDFGHKPQTUVXZ', 'playfairTorus');
</script>

<p>While I nodded, nearly napping
While I nodded, nearly napping
While I nodded, nearly napping
While I nodded, nearly napping
While I nodded, nearly napping
While I nodded, nearly napping</p>

<h2 id="known-plaintext-attack">Known Plaintext Attack</h2>

<p>Someone has helpfully enumerated a bunch of constraints. Some of the are obvious, but others, like the
the chains which allow us to fill in an entire row or column, including the exact order, are extremely
clever.
<a href="https://crypto.stackexchange.com/questions/35722/how-to-find-the-keyword-of-the-playfair-cipher-given-the-plaintext-and-the-ciph">https://crypto.stackexchange.com/questions/35722/how-to-find-the-keyword-of-the-playfair-cipher-given-the-plaintext-and-the-ciph</a></p>

<p>We have options about how we represent this problem to Z3. I found the most natural way was to use a 25x2
matrix, where each row represents a letter. The first column is the x-coordinate of that letter in the 5x5
playfair key grid, and the second is the y-coordinate. So every element of the matrix will be an integer
between 0 and 4, and we&rsquo;ll also need to make sure that a letter can go in one and only one cell.
Because they constraints apply to all Playfair key grids, we&rsquo;ll call them the universal constraints.</p>

<pre><code>from z3 import *

X = [[Int('x_%i_%i' % (i, j)) for j in range(2)] for i in range(25)]
position_constraints = [
    And(0 &lt;= X[i][j], X[i][j] &lt;= 4) 
    for j in range(2) 
    for i in range(25)
] 
distinct_constraints = [
    Distinct([X[i][0]*5 + X[i][1] 
    for i in range(25)])
]
universal_constraints = position_constraints + distinct_constraints
</code></pre>

<p>We&rsquo;ll write some helper function so help keep track of the constraints. Most of the information
will come in the form of learning that two letters are in the same row/column, or in adjacent rows/columns,
so we&rsquo;ll make it easy to describe such constraints.</p>

<pre><code>def row_col_constraint(*indices, spacing=0, orientation=0):
    constraints = [
        (X[indices[i]][orientation] + spacing) % 5 == X[indices[i+1]][orientation] 
        for i in range(len(indices) - 1)
    ]
    if len(constraints) &gt;= 2:
        return And(*constraints)
    else:
        return constraints[0]

def same_row(*indices):
    return row_col_constraint(*indices, spacing=0, orientation=0)

def same_col(*indices):
    return row_col_constraint(*indices, spacing=0, orientation=1)

def next_row(*indices):
    return row_col_constraint(*indices, spacing=1, orientation=0)

def next_col(*indices):
    return row_col_constraint(*indices, spacing=1, orientation=1)
</code></pre>

<p><img src="/post/playfair_files/rectangle_constraint.png"></p>

<p>Now we have to consider the various special cases. For example, if we see that the plaintext &ldquo;XY&rdquo; maps
to ciphertext &ldquo;AB&rdquo;, and we also see that &ldquo;AB&rdquo; maps to &ldquo;XY&rdquo;, then we know that X, Y, A, B must form a rectangle
in the key grid.</p>

<pre><code># XY -&gt; AB and AB -&gt; XY, so XA/BY form a rectangle
def rectangle_constraint(plain_digraph: str, cipher_digraph: str) -&gt; list:
    p1, p2 = (playfair_ord(c) for c in plain_digraph)
    c1, c2 = (playfair_ord(c) for c in cipher_digraph)

    return And(
        same_row(p1, c1),
        same_row(p2, c2),
        same_col(p1, c2),
        same_col(p2, c1),
        Not(same_row(p1, p2)),
        Not(same_col(p1, p2)),
        Not(same_row(c1, c2)),
        Not(same_col(c1, c2))
    )
</code></pre>

<p>There are several other such special cases to consider:</p>

<p>Chain constraints three in a row, either in a column or row:</p>

<p><img src="/post/playfair_files/chain_constraint.png"></p>

<p>In code:</p>

<pre><code># XY -&gt; PQ, PQ -&gt; YA =&gt; row/col of XPYQA
def chain_constraint(plain_digraph: str, cipher_digraph: str, next_digraph) -&gt; list:
    p1, p2 = (playfair_ord(c) for c in plain_digraph)
    c1, c2 = (playfair_ord(c) for c in cipher_digraph)
    n1, n2 = (playfair_ord(c) for c in next_digraph)

    return Or(
        And(same_row(p1, c1, p2, c2, n2), next_col(p1, c1, p2, c2, n2)),
        And(same_col(p1, c1, p2, c2, n2), next_row(p1, c1, p2, c2, n2))
    )

# XY -&gt; PQ, PQ -&gt; BX =&gt; row/col of YQXPB
# omitted for brevity...

# XY -&gt; YZ so XYZ share a row or column and are all adjacent
def adjacent_constraint(plain_digraph: str, cipher_digraph: str) -&gt; list:
    p1, p2 = (playfair_ord(c) for c in plain_digraph)
    c1, c2 = (playfair_ord(c) for c in cipher_digraph)
    assert p2 == c1

    return Or(
        And(same_row(p1, p2, c2), next_col(p1, p2, c2)),
        And(same_col(p1, p2, c2), next_row(p1, p2, c2))
    )

# XY -&gt; WX so YXW share a row or column and are all adjacent
# omitted for brevity...
</code></pre>

<p>However, even if we don&rsquo;t see any special pattern, we do actually glean a small
amount of information from every digraph we see. Remember, there are only three
cases for encoding a pair: the rectangle case, the same row case, and the same column case.
In all three, the ciphertext letter is <em>always</em> in the same row or the same column as
the plaintext letter. If it&rsquo;s the same column, then the ciphertext letter is immediately
below the plaintext character:</p>

<p><img src="/post/playfair_files/simple_constraint.png"></p>

<p>This is true for both the first and second characte of each digraph.  In code:</p>

<pre><code># XY -&gt; AB (no other information)
def simple_constraint(plain_digraph: str, cipher_digraph: str) -&gt; list:
    p1, p2 = (playfair_ord(c) for c in plain_digraph)
    c1, c2 = (playfair_ord(c) for c in cipher_digraph)

    return And(
        Or(same_row(p1, c1), And(same_col(p1, c1), next_row(p1, c1))),
        Or(same_row(p2, c2), And(same_col(p2, c2), next_row(p2, c2)))
    )
</code></pre>

<p>It&rsquo;s easy to scan through the known text and quickly build up a map of digraphs. This is also
a good opportunity to validate that the ciphertext really does look like it came from Playfair cipher.</p>

<pre><code>def parse_bigraph_map(plaintext: str, ciphertext: str) -&gt; dict:
    &quot;&quot;&quot;
    Parse and validate matching plaintext and ciphertext. A dict of distinct
    plaintext to ciphertext bigraphs mappings are returned, including all 
    mirrored mappings. This checks for obvious violations of the Playfair
    cipher algorithm and will raise an Exception if any are found.
    &quot;&quot;&quot;

    # we only care about unique/distinct digraph mappings of the form AB -&gt; XY 
    # and will ignore duplicates.
    bigraph_map = {}
    for plain_bigraph, cipher_bigraph in zip(bigraphs(plaintext), bigraphs(ciphertext)):
        # XY -&gt; AB =&gt; YX -&gt; BA, add both the original and mirrored versions to the map
        bigraph_map[plain_bigraph] = cipher_bigraph
        bigraph_map[ plain_bigraph[::-1] ] = cipher_bigraph[::-1]

    return bigraph_map
</code></pre>

<p>We have to examine each digraph mapping to see if we have enough information to identify a special
case:</p>

<pre><code>def constraints_from_known_text(plaintext: str, ciphertext: str, verbose_level=0) -&gt; list:
    &quot;&quot;&quot;
    Analyze the plain/ciphertext bigraph pairs of a message and make deductions about
    the structure of the key. These are returns as a list of Z3 constraints.
    &quot;&quot;&quot;
    bigraph_map = parse_bigraph_map(plaintext, ciphertext)

    # build up constraints
    constraints = []
    seen_already = set()
    for plain_bigraph, cipher_bigraph in bigraph_map.items():
        # we only need to handle one of each mirror version.
        if plain_bigraph[::-1] in seen_already:
            continue
        else:
            seen_already.add(plain_bigraph)

        # XY -&gt; YZ =&gt; XYZ in row or col
        if plain_bigraph[1] == cipher_bigraph[0]:
            constraints.append( adjacent_constraint(plain_bigraph, cipher_bigraph) )
            continue

        # XY -&gt; ZX =&gt; YXZ in row or col
        # omitted for brevity

        if cipher_bigraph in bigraph_map:
            next_bigraph = bigraph_map[cipher_bigraph]

            # XY -&gt; AB, AB -&gt; XY =&gt; rectangle
            if next_bigraph == plain_bigraph:
                constraints.append( rectangle_constraint(plain_bigraph, cipher_bigraph) )
                continue

            # XY -&gt; PQ, PQ -&gt; YA =&gt; row or col of XPYQA
            if plain_bigraph[1] == next_bigraph[0]:
                constraints.append( 
                    chain_constraint(plain_bigraph, cipher_bigraph, next_bigraph))
                continue

            # XY -&gt; PQ, PQ -&gt; BX =&gt; rol or col of YQXPB
            # omitted for brevity

        # AB -&gt; XY
        constraints.append( simple_constraint(plain_bigraph, cipher_bigraph) )

    return constraints
</code></pre>

<p>Now that we&rsquo;ve built up a set of Z3 constraints describing our specific problem, we can ask Z3 to find
a key meeting all of the above constraints:</p>

<pre><code>def solve_playfair_constraints(dynamic_constraints):
    solver = Solver()

    solver.add(universal_constraints)
    solver.add(dynamic_constraints)

    # Check for solution
    check = solver.check()
    if  check == sat:
        model = solver.model()
        grid = model_to_grid(model)
        return sat, grid
    else:
        return check, None
</code></pre>

<p>We can also get Z3 to keep generating different unique solutions through the simply trick of
adding a constraint specificly eliminating the previously found solution and re-solving:</p>

<pre><code>def iter_playfair_constraints(dynamic_constraints):
    solver = Solver()

    solver.add(universal_constraints)
    solver.add(dynamic_constraints)

    # Check for solution
    while True:
        check = solver.check()
        if  check == sat:
            model = solver.model()
            grid = model_to_grid(model)
            yield grid

            # block the found solution and try again
            solver.add(Or([
                X[i][j] != model[X[i][j]] 
                for i in range(25) 
                for j in range(2)
            ]))
        else:
            break
</code></pre>

<p>When given only the first 100 characters as known plaintext, this approach was able to recover
almost the entire key, except for a transposition of Z and X in the last row.</p>

<pre><code>M Y N A E
I S O R W
L B C D F
G H K P Q
T U V Z X
</code></pre>

<p>This is enough to recover most of the message:</p>

<p><img src="/post/playfair_files/kpa_visual_diff.png"></p>

<h2 id="simulated-annealing">Simulated Annealing</h2>

<p>Dual annealing, etc. Consider this function:</p>

<p>\[
    f(x) = \sum_{k=1}^{1000} \frac{{|\sin(k\pi x)|}}{k}
\]</p>

<p>Or in Python:</p>

<pre><code>def f(x, n=1000):
    return sum( abs(sin(k*pi*x))/k  for k in range(1, n+1) )
</code></pre>

<p>This function has 84,779 local minima between 0.2 and 0.8:</p>

<p><img src="/post/playfair_files/many_local_minima.png"></p>

<p>How do you find the single global minima? One answer is simulated annealing:</p>

<pre><code>from scipy.optimize import dual_annealing
dual_annealing(f, [(0.2, 0.8)], x0=[0.20001], callback=print)
</code></pre>

<p>-</p>

<pre><code>[0.5008241] [4.56639717] 0
[0.5] 4.089060034436875 1
 message: ['Maximum number of iteration reached']
 success: True
  status: 0
     fun: 4.089060034436875
       x: [ 5.000e-01]
     nit: 1000
    nfev: 2145
    njev: 72
    nhev: 0
</code></pre>

<h2 id="parallel">Parallel</h2>

<p>Pure simulated annealing</p>

<pre style="font-size: 0.77em; background-color: black; color: green; padding: 0.5em;">
Cipher Text:
VYFAOAMEUGUGMQEXNWCWWSCOBHMFZIQYWAUGYWMEWCXIEAHZLGLMNYAZMZIUQYAFQMWCZILGLTGUGLYWYPRLFAMVWRZNWCISRBINCWIPIVZMYCNYEANBCNM
ZAFHSUGROMWMVQYVORILMKSBFIUQYQNSBVIVYVIBFKRFWDRIUQYOCIXUBXMWOXMACRYIUQYOSFMMVWYMVOMMFUGAQMXGUIVQYXICNAWNZMEBILMWYBLCOBM
VYFAIXQYOSCTAWMHCIIRLZQYNICOMXLMWUMALMPBNFRGQYIXQYSQSOQAWOWCUGMEOKWMMVKCYOZMDTDMMLCOIBMZUGMYHTRLMNSVUGWRTHGUQYPROPAMRUR
YACNSYBPYDTBTMCCKGVQYWYDOMZIUPYMGWMFYAMMXGUQYFNFMIURMGMRXYWXISHVUWAYMYLAWUGAQMXGSWBDRTHGUISUGBKMDFMMKYWYMEAVIMCEBRWUGWF
RWUGAHAWOSIUEAFBMZOCUZUGAZMALTYEMLDVKCIYROFAZMSASVDAWAORCTWQRWUGROWFKSPRWAVIVYFAIXNPMZGSOSSVOAMNUGNFMFYWMLMDWAMDAGWRILW
YWYMCLTGUMAYMMVFYNSACNIIXMDKCAGWAQYYOSREV

13:33:30  17896 LWFDCOPEIZMANQRHSKGYUBXTV YRWNPMNOTHTHRNFKAFDLBALZUSNLIERGBPTHSCNOLDTEPNYODHUORKRPROOTRGNWNRLDIR    23%
13:33:30  18092 WTPQMZLVOEFYKHXRNCGISBDAU LKHSQGUMAIAIQPMERTRPSRGVAYWXERTHQSAIFTUMPREXOUFOONETYLSOWEXITHSHPQPROW    24%
13:33:30  20452 YASDBPWEQZFLGTNMCHKORXUVI RDLYCBHPHEHEKPWULZLAEAMKSOFPBOPDAXHEAPHPALRVWSOEFLFCFBBWOPVXPDYLPKALQE    17%
13:33:34  17896 NVMWFXQTZIBASOYPRUDHLCEKG FAVYSBEUHEHEVTLTFMKVMOKAYPVWTZIAVOHEOFEUVKIZCSDIGKENFBOQWTTHIAYVTVVKTX    28%
13:33:39  17896 NOMWFXQTZIBASRYPVUDHLCEKG HAOYCQEUHEHEOTLTFMKOMRVCYPOWTZIAORHERFEUOKIZCSDIGKENFBRQWTTHIAYOTOOKTX    29%
13:33:43  17896 NOMFWXQTIZBASYRPVUHDLCEGK HAOYCQEUHEHEOTLTWFKOMRVCYPOMITIAORHERFEUOKZTCSDIKEENFBRQWTTHIAYOTOOKIX    29%
13:33:44  16908 EYABDOPWFLQHIXZKSGMRCNTUV NDWBWEKBTMTMKXBQTPTOPGKEYXXBXHHEATTMAPKBOTIHDYQXWRFRSNDIRXXTHEBWXKOTX     31%
13:33:53  20452 UEYNTOVXMGPBRFALQHKWZDSCI XERFGPVNTOTOVKYVTKIKHIZMRQNMICHEAGTOTHVNKIGSTBLSWOKOYEPIOCZTHEFRKVKIDL    31%
13:33:54  16908 OPWAFQHIZRCVTLUKSGXDEYMNB HSAWFWYBTDTDEINKMATOPGQEYRBWIHHEPWTDMPYBOTGZNOQITTNMENANIRTHEWAIEOTIR     34%
13:34:08  16908 KDGXSQRIZHCUTLVOFWAPEBMNY HPOWPWBYTDTDEINKMATOPGQCYRBWIRHEFWTDMPBYOTGZNOZITTNMNLXNIRTHEWOIEOTIH     34%
13:34:12  20452 UEYITPBRACOMXKGLQHNWZFDSV DTSBKPBFTOTOBMYMHNTGNVPGRQBQSUHENCTOTHBFGTKYIBLDWOQOHIPSOFYTHEBSMBGTFL    35%
13:34:14   9896 SMOADKNCFPBWRVIUYEGHZTLXQ WGAXMOOYHEHEDTGLMNNRBMOLIUANQBTHVMHEWNOYRNQVGOUQXETOMWSSTBHTHXATDRNQX     37%
13:34:19   9896 KNCFPSMOADBWRVIUYEGHZTLXQ WGXFMOOYHEHEDTGLTMNRBMLCIUANQBTHVMHEWMOYRNQVGOUQXETOTWSSTBHTHFXTDRNQX     39%
13:34:26   6440 ZKTUFPEMYONARSCBQGHWXVIDL DEKCECEPTHTHEGPVCBOCHCOFWGOTTXHEQCTHOHEPCOLVKEBUIWIOSPNKPTDTHECKGECOKB    46%
13:34:35   6440 WGPQHFTOVUSCXNLAMDEYRIBZK UEWSFDADTHTHEGDNSQSGRFXTKPATBRHERSTHAHADGSCBDYQKCHCYLEEREIKTHESWGEGSE     50%
13:34:42  13048 DIWZNQGKHPVTXUCEMOYBFLASR UERLXOEBTHTHEGOVZIXNZAXBYPELWDHEAOTHOZEBNXTWOFZSMIMTZBSWYIZTHELRGENXDH    54%
13:34:44   6440 DFZISKLWPRUXVTOHNQGBYAEMC UEANXCEATHTHEGAVQLERRZBRGBAIFZHELETHEKEARETFAYQDPNPAHAEFEIDTHENAGEREEV    57%
13:34:47  13048 HQGPZNWIBCYEMADSFRLOUVTKX UELELDEYTHTHEGDVCNBNNFZDNPERGCHEBETHENEYNBTCYMZPRPRAHNDPDGNTHEELGENBPH    60%
13:34:55  13048 FPDLBRSOIWEYAMNZUVTCQHXGK UADEDOANTHTHEGAQWBNBIRVWPKELTRHEONTHNSANBNGONYQUGTGIMEEVETSTHEEDGEBNE     60%
13:34:57   6440 WLRBFPICSOEMYNAQGHKDZTUVX UNXOFOEATHTHEGAZEBPRBPISRKALTPHEFETHEREARPTOANQUTMTIYMEETCTHEOXGERPQE     64%
13:35:00  13048 ISORWLBKCFGHDPQTUVXZMYNAE UNCERNEATHTHEGAZEOFRRIKRSBELTWHERETHESEARFTRANQUILITYMEETSTHEECGERFQF     79%
13:35:01   6440 BCDFLUVXZTHKPQGYNAEMSORWI UNDERNEATHTHEGAZEOFORIONSUELTWHERETHESEAOFTRANQUITIGYMEETSTHEEDGEOFF      83%
13:35:04  13048 ISORWLBCDFGHPKQTUVXZMYNAE UNDERNEATHTHEGAZEOFORIONSBELTWHERETHESEAOFTRANQUILITYMEETSTHEEDGEOFQF     85%
13:35:06   6440 BCDFLHKPQGUVXZTYNAEMSORWI UNDERNEATHTHEGAZEOFORIONSBELTWHERETHESEAOFTRANQUILITYMEETSTHEEDGEOFQF     87%

Candidate solution found!
Key: BCDFLHKPQGUVXZTYNAEMSORWI
Bigraph/Trigraph Score: 87%

Plain Text:
UNDERNEATHTHEGAZEOFORIONSBELTWHERETHESEAOFTRANQUILITYMEETSTHEEDGEOFTWILIGHTLIESAHIDDENTROVEOFWISDOMFORGOTTENBYMANYCOVET
EDBYTHOSEINTHEKNOWITHOLDSTHEKEYSTOUNTOLDPOWERASTHENORTHSTARSTANDSASTHESILENTSENTINELTHEPATHTOTHETROVEREVEALSITSELFONLYU
NDERTHESILVERYGLOWOFTHEMOONATITSZENITHDECIPHERTHEWHISPERSOFTHEANCIENTCONSTELLATIONSLETTHEMGUIDEYOUTHROUGHTHEDARKNESSAND
YOUSHALLUNLOCKTHESECRETSTHATLIEBENEATHTHECELESTIALTAPESTRYBUTREMEMBERTHEPATHISFRAUGHTWITHCHALLENGESMEANTONLYFORTHEWORTH
YPERSISTANDLETNOTTHEENIGMATICCOSMOSDETERYOURRESOLVEFORTHOSEWHODARETOUNDERTAKETHISIOURNEYTHECELESTIALREALMPROMISESENLIGH
TENMENTBEYONDMORTALCOMPREHENSION

Segmented Plain Text:
UNDERNEATH THE GAZE OF ORIONS BELT WHERE THE SEA OF TRANQUILITY MEETS THE EDGE OF TWILIGHT LIES A HIDDEN TROVE OF
WISDOM FORGOTTEN BY MANY COVETED BY THOSE IN THE KNOW IT HOLDS THE KEYS TO UNTOLD POWER AS THE NORTHSTAR STANDS AS THE
SILENT SENTINEL THE PATH TO THE TROVE REVEALS ITSELF ONLY UNDER THE SILVERY GLOW OF THE MOON AT ITS ZENITH DECIPHER THE
WHISPERS OF THE ANCIENT CONSTELLATIONS LET THEM GUIDE YOU THROUGH THE DARKNESS AND YOU SHALL UNLOCK THE SECRETS THAT
LIE BENEATH THE CELESTIAL TAPESTRY BUT REMEMBER THE PATH IS FRAUGHT WITH CHALLENGES MEANT ONLY FOR THE WORTHY PERSIST
AND LET NOT THE ENIGMATIC COSMOS DETER YOUR RESOLVE FOR THOSE WHO DARE TO UNDERTAKE THIS I OUR NEY THE CELESTIAL REALM
PROMISES ENLIGHTENMENT BEYOND MORTAL COMPREHENSION

English Word Score: 91%
Accepted solution.
</pre>

<h2 id="cython">Cython</h2>

<p>Python is actually very slow at character-by-character string manipulation. Unfortunately,
that&rsquo;s exactly what the inner loop of <code>Playfair.decrypt()</code> is doing. We can use Cython
to optimize the performance critical section of the code:</p>

<pre><code>@cython.boundscheck(False)
@cython.wraparound(False)
cpdef str playfair_decrypt(str cipher_text, str key):
    &quot;&quot;&quot;
    Decrypt the given cipher text using the Playfair cipher with the provided key.

    Arguments:
    cipher_text -- The encrypted text. Must contain an even number of uppercase letters.
    key -- The key for decryption. Must be exactly 25 uppercase letters.

    Returns:
    The decrypted text.
    &quot;&quot;&quot;
    cdef int i, j
    cdef int n = len(cipher_text)

    # populate a reverse lookup table
    cdef int[25][2] reverse_lookup
    for i in range(25):
        j = playfair_ord(key[i])
        reverse_lookup[j][0] = i // 5
        reverse_lookup[j][1] = i % 5

    # Allocate memory for the result
    cdef char* decrypted_text = &lt;char*&gt;malloc(n+1)
    if not decrypted_text:
        raise MemoryError()

    # decrypt playfair cipher
    cdef int x1, x2, y1, y2
    try:
        # Loop over the characters in cipher_text
        for i in range(0, n, 2):
            x1, y1 = reverse_lookup[playfair_ord(cipher_text[i])]
            x2, y2 = reverse_lookup[playfair_ord(cipher_text[i+1])]

            if x1 == x2:
                decrypted_text[i] = key[5*x1 + (y1-1)%5]
                decrypted_text[i+1] = key[5*x2 + (y2-1)%5]
            elif y1 == y2:
                decrypted_text[i] = key[5*((x1-1)%5) + y1]
                decrypted_text[i+1] = key[5*((x2-1)%5) + y2]
            else:
                decrypted_text[i] = key[5*x1 + y2]
                decrypted_text[i+1] = key[5*x2 + y1]

        # Null-terminate the string
        decrypted_text[n] = b'\0'

        # Convert the byte array back to a Python string to return it
        return decrypted_text.decode('utf-8')

    finally:
        # Free the allocated memory
        free(decrypted_text)
</code></pre>

    </article>

    <hr>


    <ul class="pager article-pager">
      <li class="pager-newer pager-noitem">&lt; Newer</li>
      <li class="pager-older">
        <a href="/post/my-dinner-with-chatgpt/" data-toggle="tooltip" data-placement="top" title="My Dinner with ChatGPT">Older &gt;</a>
      </li>
    </ul>
  </div>


<div class="site-footer">
  <div class="copyright">
	  &copy; Copyright 2023 Oran Looney
  </div>
  <ul class="site-footer-items">
  </ul>
  <div class="powerdby">
    Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a>
  </div>
</div>
<script src="/js/script.js"></script>
<script src="/js/custom.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    displayMath: [ ["\\[","\\]"] ],  // ['$$','$$'], 
    processEscapes: true,
    processEnvironments: true
  },
  // Center justify equations in code and markdown cells. Elsewhere
  // we use CSS to left justify single line equations in code cells.
  displayAlign: 'center',
  "HTML-CSS": {
    styles: {'.MathJax_Display': {"margin": 0}},
    linebreaks: { automatic: true }
  },
  TeX: { extensions: ["color.js"] }
});
</script>


<link rel="stylesheet"
	href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>
  hljs.configure({
    languages: ['python', 'r', 'javascript']
  })
  hljs.initHighlightingOnLoad()
</script>



</body>
</html>
